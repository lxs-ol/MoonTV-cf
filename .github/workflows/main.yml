name: Sync Upstream Repository

# 触发条件：1. 每天凌晨3点自动运行 2. 手动触发
on:
  schedule:
    - cron: '0 3 * * *'  # 时区为 UTC，对应北京时间 11:00（可自行调整）
  workflow_dispatch:  # 手动触发开关

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：检出当前仓库
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 拉取完整历史，避免合并冲突

      # 步骤2：配置 Git 身份（必须，否则无法提交）
      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      # 步骤3：添加上游仓库并同步
      - name: Sync with upstream
        run: |
          # 添加上游仓库（替换为实际的上游仓库地址）
          git remote add upstream https://github.com/Stardm0/MoonTV.git
          # 拉取上游所有更新
          git fetch upstream
          # 切换到主分支
          git checkout main
          # 合并上游主分支（使用 --ff-only 避免不必要的合并提交，有冲突则终止）
          git merge --ff-only upstream/main
          # 推送到自己的 Fork 仓库
          git push origin main
